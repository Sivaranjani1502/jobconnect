<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Employer Dashboard - JobConnect</title>

    <!-- CSS is directly under /static -->
    <link rel="stylesheet" th:href="@{/employer-dashboard.css}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="dashboard-container">
    <!-- Header -->
    <header class="header">
        <h1 id="dashboard-title">Employer Dashboard</h1>
		<div class="user-info">
		        <span th:text="${employerName}">User</span>
		        <div class="user-avatar" th:text="${employerInitials}">U</div>
		    </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">

        <!-- STATS -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background:#dbeafe; color:#1e40af;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2">
                        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                    </svg>
                </div>
                <h3>Active Jobs</h3>
                <!-- uses activeJobsCount from controller -->
				<div class="stat-value" id="active-jobs-count"
				     th:text="${activeJobsCount}">0</div>
					 </div>
                        <div class="stat-card">
				    <div class="stat-icon" style="background:#fef3c7; color:#92400e;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </div>
                <h3>Total Applicants</h3>
                <!-- uses totalApplicantsCount from controller -->
                <div class="stat-value" th:text="${totalApplicantsCount}">0</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background:#d1fae5; color:#065f46;">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                         stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                    </svg>
                </div>
                <h3>Total Jobs</h3>
                <!-- uses totalJobsCount from controller -->
                <div class="stat-value" th:text="${totalJobsCount}">0</div>
            </div>
        </div>

        <!-- GLOBAL SUCCESS / ERROR (AFTER REDIRECT) -->
        <div th:if="${jobSuccess}" class="success-message" th:text="${jobSuccess}"></div>
        <div th:if="${jobError}" class="error-message" th:text="${jobError}"></div>

        <!-- Actions Bar -->
        <div class="actions-bar">
            <h2>Job Postings</h2>
            <button class="btn btn-primary" id="post-job-btn" type="button">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Post New Job
            </button>
        </div>

        <!-- Jobs List -->
        <div class="jobs-container">

            <!-- If NO jobs -->
            <div th:if="${#lists.isEmpty(jobs)}" class="empty-state">
                <svg viewBox="0 0 24 24" fill="none"
                     stroke="currentColor" stroke-width="2">
                    <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                    <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                </svg>
                <h3>No job postings yet</h3>
                <p>Click "Post New Job" to create your first job listing</p>
            </div>

            <!-- If jobs exist -->
            <div th:each="job : ${jobs}" class="job-card">
                <div class="job-header">
                    <div>
                        <div class="job-title" th:text="${job.title}">Job Title</div>
                        <div class="job-meta">
                            <span>üìç <span th:text="${job.location}">Location</span></span>
                            <span>üíº <span th:text="${job.jobType}">Type</span></span>
                            <span>üí∞ <span th:text="${job.salary}">Salary</span></span>
							<span th:if="${job.deadline != null}">
							        ‚è∞ Apply by
							        <span th:text="${#temporals.format(job.deadline, 'dd MMM yyyy')}">01 Jan 2026</span>
							    </span>
                        </div>
                    </div>
                    <div>
                        <span class="badge"
                              th:classappend="${job.active} ? ' badge-active' : ' badge-closed'"
                              th:text="${job.active} ? 'Active' : 'Closed'">
                            Active
                        </span>
                        <span class="badge badge-applicants">
                            <span th:text="${#lists.size(job.applications)}">0</span> applicants
                        </span>
                    </div>
                </div>

                <div class="job-description"
                     th:text="${job.description}">
                    Short description...
                </div>
				<div class="job-actions">
					<!-- Edit -->
					<a th:href="@{|/employer/jobs/${job.id}/edit|}"
					   class="btn btn-secondary btn-sm">
					    Edit
					</a>
				    <!-- Open / Close -->
				    <form th:action="@{|/employer/jobs/${job.id}/toggle|}" method="post" style="display:inline;">
				        <button type="submit" class="btn btn-secondary btn-sm"
				                th:text="${job.active} ? 'Close Job' : 'Reopen Job'">
				            Close Job
				        </button>
				    </form>

				    <!-- Delete -->
				    <form th:action="@{|/employer/jobs/${job.id}/delete|}" method="post" style="display:inline;"
				          onsubmit="return confirm('Are you sure you want to delete this job?');">
				        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
				    </form>

				    <!-- View applicants (used in step 4) -->
				    <a th:href="@{|/employer/jobs/${job.id}/applications|}"
				       class="btn btn-secondary btn-sm">
				        View Applicants
				    </a>
				</div>

            </div>

        </div>
    </main>

    <!-- Post Job Modal -->
    <div class="modal" id="post-job-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Post New Job</h2>
                <button class="modal-close" id="modal-close" type="button">√ó</button>
            </div>

            <!-- Messages from backend (if you ever want inside modal too) -->
            <div class="success-message"
                 th:if="${jobSuccess}"
                 th:text="${jobSuccess}"></div>

            <div class="error-message"
                 th:if="${jobError}"
                 th:text="${jobError}"></div>

            <!-- FORM posts directly to Spring -->
            <form th:action="@{/employer/jobs}" method="post" class="job-form">
                <!-- Job Title -->
                <div class="form-group">
                    <label for="title">Job Title *</label>
                    <input type="text" id="title" name="title"
                           placeholder="e.g. Senior Software Engineer" required />
                </div>

                <!-- Location -->
                <div class="form-group">
                    <label for="location">Location *</label>
                    <input type="text" id="location" name="location"
                           placeholder="e.g. San Francisco, CA" required />
                </div>

                <!-- Job Type -->
                <div class="form-group">
                    <label for="jobType">Job Type *</label>
                    <select id="jobType" name="jobType" required>
                        <option value="">Select job type</option>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contract">Contract</option>
                        <option value="Remote">Remote</option>
                    </select>
                </div>

                <!-- Salary Range -->
                <div class="form-group">
                    <label for="salaryRange">Salary Range *</label>
                    <input type="text" id="salaryRange" name="salaryRange"
                           placeholder="e.g. ‚Çπ7,00,000 ‚Äì ‚Çπ12,00,000 per annum" required />
                </div>
				<!-- Deadline -->
				<div class="form-group">
				    <label for="deadline">Application Deadline *</label>
				    <input type="date" id="deadline" name="deadline" required />
				</div>

                <!-- Description -->
                <div class="form-group">
                    <label for="description">Job Description *</label>
                    <textarea id="description" name="description" required
                              placeholder="Describe the role, responsibilities, and what you're looking for..."></textarea>
                </div>

                <!-- Requirements -->
                <div class="form-group">
                    <label for="requirements">Requirements *</label>
                    <textarea id="requirements" name="requirements" required
                              placeholder="List the skills, experience, and qualifications needed..."></textarea>
                </div>

                <button type="submit" class="primary-btn w-100">
                    Post Job
                </button>
            </form>
        </div>
    </div>

    <!-- Confirm Delete Modal (still only UI for now) -->
    <div class="modal" id="delete-modal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2>Confirm Deletion</h2>
                <button class="modal-close" id="delete-modal-close" type="button">√ó</button>
            </div>
            <p style="margin-bottom: 1.5rem; color: #6b7280;">
                Are you sure you want to delete this job posting? This action cannot be undone.
            </p>
            <div style="display: flex; gap: 1rem;">
                <button class="btn btn-secondary" style="flex: 1;" id="cancel-delete" type="button">
                    Cancel
                </button>
                <button class="btn btn-danger" style="flex: 1;" id="confirm-delete" type="button">
                    Delete
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Minimal JS just for opening/closing modals -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const postJobBtn = document.getElementById('post-job-btn');
        const postJobModal = document.getElementById('post-job-modal');
        const modalClose = document.getElementById('modal-close');

        const deleteModal = document.getElementById('delete-modal');
        const deleteClose = document.getElementById('delete-modal-close');
        const cancelDelete = document.getElementById('cancel-delete');

        function openModal(modal) {
            if (modal) modal.classList.add('active');
        }

        function closeModal(modal) {
            if (modal) modal.classList.remove('active');
        }

        if (postJobBtn) {
            postJobBtn.addEventListener('click', function () {
                openModal(postJobModal);
            });
        }

        if (modalClose) {
            modalClose.addEventListener('click', function () {
                closeModal(postJobModal);
            });
        }

        if (postJobModal) {
            postJobModal.addEventListener('click', function (e) {
                if (e.target === postJobModal) {
                    closeModal(postJobModal);
                }
            });
        }

        if (deleteClose) {
            deleteClose.addEventListener('click', function () {
                closeModal(deleteModal);
            });
        }

        if (cancelDelete) {
            cancelDelete.addEventListener('click', function () {
                closeModal(deleteModal);
            });
        }

        if (deleteModal) {
            deleteModal.addEventListener('click', function (e) {
                if (e.target === deleteModal) {
                    closeModal(deleteModal);
                }
            });
        }
    });
</script>
</body>
</html>
